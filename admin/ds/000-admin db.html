<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FloMViDex Admin</title>
  <style>
    * {{ margin: 0; padding: 0; box-sizing: border-box; }}

    body {{ 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #e5e7eb;
      padding: 20px;
    }}

    .dashboard {{ 
      max-width: 1200px; 
      margin: 0 auto; 
    }}

    .header {{ 
      background: #ffffff; 
      border-radius: 12px; 
      padding: 16px; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 16px; 
      margin-bottom: 16px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }}

    .header-block {{ 
      flex: 1 1 260px; 
    }}

    h1 {{ 
      font-size: 1.4rem; 
      margin-bottom: 4px; 
    }}

    h2 {{ 
      font-size: 1rem; 
      margin-bottom: 8px; 
    }}

    .subtitle {{ 
      font-size: 0.85rem; 
      color: #6b7280; 
      margin-bottom: 8px; 
    }}

    .tabs {{ 
      display: flex; 
      flex-wrap: wrap; 
      gap: 6px; 
      margin-bottom: 8px; 
    }}

    .tab {{ 
      padding: 6px 10px; 
      border-radius: 999px; 
      border: 1px solid #d1d5db; 
      background: #f9fafb; 
      font-size: 0.85rem; 
      cursor: pointer; 
    }}

    .tab.active {{ 
      background: #6366f1; 
      border-color: #4f46e5; 
      color: #ffffff; 
    }}

    .current-dir {{ 
      font-size: 0.85rem; 
      color: #374151; 
      margin-bottom: 8px; 
    }}

    .search-input {{ 
      width: 100%; 
      padding: 8px 10px; 
      border-radius: 8px; 
      border: 1px solid #d1d5db; 
      font-size: 0.9rem; 
    }}

    .search-input:focus {{ 
      outline: none; 
      border-color: #6366f1; 
    }}

    .player-info {{ 
      font-size: 0.85rem; 
      color: #4b5563; 
      margin-bottom: 6px; 
      min-height: 16px; 
    }}

    #main-player {{ 
      width: 100%; 
    }}

    .form {{ 
      display: flex; 
      flex-direction: column; 
      gap: 8px; 
    }}

    .form input[type="text"],
    .form input[type="file"] {{ 
      padding: 8px 10px; 
      border-radius: 8px; 
      border: 1px solid #d1d5db; 
      font-size: 0.9rem; 
    }}

    .form button {{ 
      align-self: flex-start; 
      padding: 8px 14px; 
      border-radius: 8px; 
      border: none; 
      background: #6366f1; 
      color: #ffffff; 
      font-size: 0.85rem; 
      cursor: pointer; 
    }}

    .form button:hover {{ 
      background: #4f46e5; 
    }}

    .form-small-text {{ 
      font-size: 0.75rem; 
      color: #6b7280; 
    }}

    .table-wrapper {{ 
      background: #ffffff; 
      border-radius: 12px; 
      padding: 12px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }}

    table {{ 
      width: 100%; 
      border-collapse: collapse; 
      font-size: 0.9rem; 
    }}

    th, td {{ 
      padding: 8px; 
      border-bottom: 1px solid #e5e7eb; 
      text-align: left; 
    }}

    th {{ 
      background: #f9fafb; 
      font-weight: 600; 
    }}

    tr:hover td {{ 
      background: #f3f4f6; 
    }}

    .no-data {{ 
      text-align: center; 
      color: #6b7280; 
      font-style: italic; 
    }}

    .actions {{ 
      display: flex; 
      gap: 6px; 
      flex-wrap: wrap; 
    }}

    .btn {{ 
      padding: 4px 8px; 
      border-radius: 6px; 
      border: 1px solid #d1d5db; 
      background: #f9fafb; 
      font-size: 0.8rem; 
      cursor: pointer; 
    }}

    .btn-play {{ 
      border-color: #10b981; 
      color: #065f46; 
    }}

    .btn-delete {{ 
      border-color: #ef4444; 
      color: #7f1d1d; 
    }}
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <!-- Bloque 1: Tabs + búsqueda -->
      <div class="header-block">
        <h1>FloMViDex Admin</h1>
        <p class="subtitle">Gestión sencilla de tracks maidcore (por directorios)</p>

        <div class="tabs">
          <button class="tab active" data-dir="mc1">maidcore 1.0</button>
          <button class="tab" data-dir="mc2">maidcore 2.0</button>
          <button class="tab" data-dir="mc3">maidcore 3.0</button>
          <button class="tab" data-dir="mc4">maidcore 4.0</button>
        </div>

        <div class="current-dir" id="current-dir-label">
          Directorio actual: mc1
        </div>

        <input
          type="text"
          id="search-input"
          class="search-input"
          placeholder="Buscar por título o archivo (mp3)..."
        >
      </div>

      <!-- Bloque 2: Reproductor -->
      <div class="header-block">
        <h2>Reproductor</h2>
        <div class="player-info" id="player-info">
          Ningún track seleccionado
        </div>
        <audio id="main-player" controls>
          Tu navegador no soporta el elemento de audio.
        </audio>
      </div>

      <!-- Bloque 3: Subida múltiple -->
      <div class="header-block">
        <h2>Subir nuevos tracks</h2>
        <form id="create-form" class="form">
          <input type="text" name="title" placeholder="Título base (opcional)">
          <input type="file" name="files" accept=".mp3" multiple required>
          <button type="submit">Subir .mp3</button>
          <span class="form-small-text">
            Puedes seleccionar varios archivos .mp3 a la vez.  
            Si no pones título, se usará el nombre del archivo.
          </span>
        </form>
      </div>
    </div>

    <!-- Tabla de tracks -->
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Título</th>
            <th>Archivo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tracks-body">
          <!-- Filas generadas por JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Datos simulados por directorio
    const tracksByDirectory = {
      mc1: [
        { id: 1, title: 'Maidcore Intro', file: 'maidcore_intro.mp3' },
        { id: 2, title: 'FloMViDex Theme', file: 'flomvidex_theme.mp3' }
      ],
      mc2: [
        { id: 1, title: 'Maidcore 2.0 – Café', file: 'maidcore_cafe.mp3' }
      ],
      mc3: [],
      mc4: []
    };

    let currentDirectory = 'mc1';
    const nextIdByDirectory = { mc1: 3, mc2: 2, mc3: 1, mc4: 1 };

    // Elementos DOM
    const tabs = document.querySelectorAll('.tab');
    const dirLabel = document.getElementById('current-dir-label');
    const searchInput = document.getElementById('search-input');
    const tableBody = document.getElementById('tracks-body');
    const createForm = document.getElementById('create-form');
    const mainPlayer = document.getElementById('main-player');
    const playerInfo = document.getElementById('player-info');

    // Cambiar de directorio al hacer clic en una tab
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentDirectory = tab.dataset.dir;
        dirLabel.textContent = 'Directorio actual: ' + currentDirectory;
        loadTracks();
      });
    });

    // Cargar tracks con filtro de búsqueda
    function loadTracks() {
      const term = searchInput.value.trim().toLowerCase();
      const all = tracksByDirectory[currentDirectory] || [];

      const filtered = all.filter(track => {
        const t = track.title.toLowerCase();
        const f = track.file.toLowerCase();
        return t.includes(term) || f.includes(term);
      });

      renderTable(filtered);
    }

    function renderTable(tracks) {
      tableBody.innerHTML = '';

      if (tracks.length === 0) {
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 4;
        cell.textContent = 'No hay tracks en este directorio.';
        cell.className = 'no-data';
        row.appendChild(cell);
        tableBody.appendChild(row);
        return;
      }

      tracks.forEach(track => {
        const row = document.createElement('tr');

        const idCell = document.createElement('td');
        idCell.textContent = track.id;

        const titleCell = document.createElement('td');
        titleCell.textContent = track.title;

        const fileCell = document.createElement('td');
        fileCell.textContent = track.file;

        const actionsCell = document.createElement('td');
        actionsCell.className = 'actions';

        const playBtn = document.createElement('button');
        playBtn.textContent = 'Reproducir';
        playBtn.className = 'btn btn-play';
        playBtn.addEventListener('click', () => playTrack(track));

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Eliminar';
        deleteBtn.className = 'btn btn-delete';
        deleteBtn.addEventListener('click', () => deleteTrack(track.id));

        actionsCell.appendChild(playBtn);
        actionsCell.appendChild(deleteBtn);

        row.appendChild(idCell);
        row.appendChild(titleCell);
        row.appendChild(fileCell);
        row.appendChild(actionsCell);

        tableBody.appendChild(row);
      });
    }

    function playTrack(track) {
      // Aquí deberías poner la ruta real donde sirves los .mp3
      // Ejemplo: const src = '/audio/' + currentDirectory + '/' + track.file;
      const src = track.file; // Placeholder

      mainPlayer.src = src;
      mainPlayer.play().catch(() => {});
      playerInfo.textContent = track.title + ' – ' + track.file;
    }

    function deleteTrack(id) {
      const list = tracksByDirectory[currentDirectory];
      const index = list.findIndex(t => t.id === id);
      if (index !== -1) {
        list.splice(index, 1);
        loadTracks();
      }
    }

    // Subida múltiple de archivos .mp3 (simulada)
    createForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(createForm);
      const baseTitle = (formData.get('title') || '').trim();
      const files = formData.getAll('files');

      if (!files || files.length === 0) return;

      files.forEach((file, index) => {
        if (!file || !file.name) return;

        const fileName = file.name;
        const title =
          baseTitle !== ''
            ? (files.length > 1 ? baseTitle + ' (' + (index + 1) + ')' : baseTitle)
            : fileName.replace(/\.mp3$/i, '');

        const newTrack = {
          id: nextIdByDirectory[currentDirectory]++,
          title: title,
          file: fileName
        };

        tracksByDirectory[currentDirectory].push(newTrack);
      });

      createForm.reset();
      loadTracks();
    });

    // Buscar en tiempo real
    searchInput.addEventListener('input', loadTracks);

    // Inicializar
    loadTracks();
  </script>
</body>
</html>
